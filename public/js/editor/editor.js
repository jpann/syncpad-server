function successAlert(e){$("#alert-success-txt").text(e),$("#alert-success").show(),$("#alert-success").fadeTo(2e3,500).slideUp(500,function(){$("#alert-success").slideUp(500)})}function errorAlert(e){$("#alert-error-txt").text(e),$("#alert-error").show(),$("#alert-error").fadeTo(2e3,500).slideUp(500,function(){$("#alert-error").slideUp(500)})}function generateKey(){var e=CryptoJS.lib.WordArray.random(16).toString();$("#room-passcode-setting").val(e)}function generatePasscode(){$("#room-passcode-setting").val(humanReadableIds.random())}function encrypt(e,t){return CryptoJS.AES.encrypt(e,t).toString()}function decrypt(e,t){return CryptoJS.AES.decrypt(e,t).toString(CryptoJS.enc.Utf8)}function updateStatus(e){e=`[${moment().local().format("MM/DD/YYYY h:mm:ss a")}]: ${e}`,$("#status-list").prepend($('<li class="list-group-item">').text(e))}function notify(e){$.notify(e,{style:"grey"})}function connect(o,n){let a="",r=null;var s=new Quill("#editor",{modules:{toolbar:"#toolbar"},theme:"snow"}),c=io({query:"&roomId="+o,reconnectionDelay:1e4});let i=null;function t(){var e=$("#chat-panel-msg").val();e&&(e=encrypt(e,a),c.emit("chat:msg",{message:e}),$("#chat-panel-msg").val(""))}c.on("connect",function(){updateStatus("You connected to the server.")}),c.on("auth:exchange",function(e,t){var o=e.key;updateStatus("Creating public key."),r=bCrypto.createECDH("secp521r1"),r.generateKeys("hex");e=r.getPublicKey("hex");i=r.computeSecret(o,"hex","hex"),updateStatus("Sending public key."),t({key:e})}),c.on("room:auth",function(e,t){updateStatus("Initiating room authentication."),t({passcode:n})}),c.on("authenticated",function(e){var t=e.key,o=e.passcode,n=e.username,r=e.roomId;updateStatus("Finishing key exchange."),i?(o=decrypt(o,i),a=decrypt(t,i),a?(updateStatus("Key exchange complete."),updateStatus(`You are now authenticated in room ${e.roomId}.`),$("#room-id-info").val(r),$("#room-passcode-info").val(o),$("#room-username-info").val(n),$("title").text(`${n}@${r} - syncpad editor`),$("#settings-modal").data()["bs.modal"].isShown&&$("#settings-modal").modal("toggle")):updateStatus("Key exchange failed. Failed to decrypt key.")):updateStatus("Key exchange failed. Secret is not defined.")}),c.on("unauthorized",function(e){var t=e.message;e.roomId;updateStatus(`You are not authorized in room ${e.roomId}: ${t}`),errorAlert(`You are not authorized in room ${e.roomId}: ${t}`)}),c.on("connect_error",function(e){updateStatus(`connect_error: ${e.error}`),errorAlert(`connect_error: ${e.error}`)}),c.on("connect_timeout",function(e){updateStatus(`connect_timeout: ${e.error}`),errorAlert(`connect_timeout: ${e.error}`)}),c.on("error",function(e){updateStatus(`Error: ${e.error}`),errorAlert(`Error: ${e.error}`)}),c.on("disconnect",function(e){updateStatus("Disconnected from server.")}),c.on("room:join",function(e){updateStatus(`User ${e.user} joined the room.`),notify(`User ${e.user} joined the room.`)}),c.on("room:leave",function(e){updateStatus(`User ${e.user} left the room from.`),notify(`User ${e.user} left the room.`)}),c.on("text:latest",function(e){e.user;var t=e.id,o=s.getContents(),o=encrypt(e=JSON.stringify(o),a);console.log("text:latest: "+e),c.emit("text:refresh",{id:t,text:o})}),c.on("text",function(e){e.user;var t=decrypt(e.text,a),e=JSON.parse(t);console.log("text => "+JSON.stringify(e)),s.updateContents(e,"silent")}),c.on("text:typing",function(e){}),c.once("text:refresh",function(e){var t=decrypt(e.text,a);t?(e=JSON.parse(t),console.log("text:refresh: "+t),s.setContents(e,"silent")):updateStatus("Editor refresh failed.")}),c.on("chat:msg",function(e){var t=e.user;!function(e,t){t=sanitizeHtml(t);t=`<p class="list-group-item-heading"><p style="font-size: 15px; color: #1ac6ff">${e}</p></p>
                <p class="list-group-item-text" style="text-align: left; ">${t} <span style="float: right; font-size: 9px; color: #B0B0B0">${moment().local().format("h:mm:ss a")}</span></p>`;$("#chat-panel-messages").append($('<li class="list-group-item">').html(t)),$("#chat-panel-body").scrollTop($("#chat-panel-body")[0].scrollHeight)}(t,decrypt(e.message,a)),t!=$("#room-username-info").val()&&notify(`Message from ${t}.`)}),s.on("text-change",function(e,t,o){"user"==o&&(e=encrypt(JSON.stringify(e),a),c.emit("text",{text:e}))}),s.on("selection-change",function(e,t,o){e&&c.emit("text:typing")}),$("#users-button").click(function(){c.emit("users:list",null,function(t){$("#user-table tbody").empty(),$.each(t,function(e){e=t[e];$("#user-table tbody").append(`
                    <tr>
                        <td>${e.username}</td>
                        <td>${moment(e.connectedTime).local().fromNow()}</td>
                        <td>${moment(e.lastUpdateTime).local().fromNow()}</td>
                    </tr>
                    `)}),$("#users-modal").modal("toggle")})}),$("#room-username-change").click(function(){var e=$("#room-username-info").val();e&&c.emit("chat:name change",{username:e},function(e,t){e?(console.log("username already exists in room."),$("#room-username-info").val(t.username)):($("#room-username-info").val(t.username),$("title").text(`${t.username}@${o} - syncpad editor`))})}),$("#chat-panel-send").click(function(){t()}),$("#chat-panel-msg").on("keydown",function(e){13==e.which&&t()})}$(function(){$("#alert-error").hide(),$.notify.addStyle("grey",{html:"<div><span data-notify-text/></div>",classes:{base:{"white-space":"nowrap","background-color":"#B6E2FE",padding:"5px",color:"#000000",border:"1px solid #000000","border-radius":"4px"}}}),$.notify.defaults({globalPosition:"bottom right",autoHideDelay:2e3}),$("#share-url").val(window.location.href),$("#settings-modal").modal("show"),$("#generate-key").popover().click(function(){setTimeout(function(){$("#generate-key").popover("hide")},2e3)}),$("#chat-button").click(function(){$("#chat-modal").modal("toggle")}),$("#info-button").click(function(){$("#info-modal").modal("toggle")}),$("#debug-info-button").click(function(){$("#debug-modal").modal("toggle")}),$(".generate-key").click(function(){generateKey()}),$(".generate-passcode").click(function(){generatePasscode()}),$("#cancel").click(function(){window.location.replace("/")}),$(".connect").click(function(){var e,t=$("#room-passcode-setting").val();t&&6<=t.length?($("#passcode").val(t),(e=$("#roomId").val())&&t?(updateStatus(`Connecting to room ${e}...`),connect(e,t)):errorAlert("Error: Invalid room ID or passcode.")):errorAlert("Please provide a passcode that is more than 6 characters.")})}),$(".alert .close").on("click",function(e){$(this).parent().hide()});